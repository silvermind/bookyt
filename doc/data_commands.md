Apartment::Tenant.switch!('novotec')


Tenant.first.settings(:modules).active
Tenant.first.settings(:modules).active

start_date = Date.new(2014,1,1) #Date.today.beginning_of_year
end_date = Date.new(2014,12,31) #Date.today.end_of_year

# get all invoices
invs = Invoice.where(value_date: start_date..end_date)
invs.each do |invoice|
  invoice.line_items.collect do |li|
    li.save!
  end
end


bookings_count = Booking.where(value_date: start_date..end_date).count

bookings = Booking.where(value_date: start_date..end_date)
bookings.collect do |booking|
  booking.inspect
end

bookings.collect do |booking|
  {booking.id => booking.amount.to_s}
end


bookings.collect do |booking|
  booking.save!
end

# before change
[{2603=>"720.0"}, {2493=>"9200.0"}, {2494=>"473.0"}, {2495=>"101.0"}, {2496=>"101.0"}, {2497=>"61.0"}, {2498=>"334.0"}, {2499=>"400.0"}, {2500=>"7000.0"}, {2501=>"360.0"}, {2502=>"77.0"}, {2503=>"77.0"}, {2504=>"46.0"}, {2505=>"316.0"}, {2506=>"14757.0"}, {2507=>"1229.0"}, {2508=>"335.0"}, {2509=>"840.0"}, {2510=>"179.0"}, {2511=>"179.0"}, {2512=>"109.0"}, {2513=>"510.0"}, {2514=>"13442.0"}, {2515=>"1119.0"}, {2516=>"305.0"}, {2517=>"765.0"}, {2518=>"163.0"}, {2519=>"163.0"}, {2520=>"99.0"}, {2521=>"346.0"}, {2522=>"1447.0"}, {2523=>"450.0"}, {2524=>"21880.0"}, {2525=>"1822.0"}, {2526=>"496.0"}, {2527=>"1246.0"}, {2528=>"266.0"}, {2529=>"266.0"}, {2530=>"162.0"}, {2531=>"489.0"}, {2532=>"12154.0"}, {2533=>"1012.0"}, {2534=>"275.0"}, {2535=>"692.0"}, {2536=>"147.0"}, {2537=>"147.0"}, {2538=>"90.0"}, {2539=>"530.0"}, {2540=>"7000.0"}, {2541=>"360.0"}, {2542=>"77.0"}, {2543=>"77.0"}, {2544=>"46.0"}, {2545=>"316.0"}, {2546=>"11375.0"}, {2547=>"947.0"}, {2548=>"258.0"}, {2549=>"647.0"}, {2550=>"138.0"}, {2551=>"138.0"}, {2552=>"84.0"}, {2553=>"510.0"}, {2554=>"9200.0"}, {2555=>"473.0"}, {2556=>"101.0"}, {2557=>"101.0"}, {2558=>"61.0"}, {2559=>"334.0"}, {2560=>"400.0"}, {2561=>"13796.0"}, {2562=>"1149.0"}, {2563=>"313.0"}, {2564=>"785.0"}, {2565=>"167.0"}, {2566=>"167.0"}, {2567=>"102.0"}, {2568=>"346.0"}, {2569=>"1540.0"}, {2570=>"450.0"}, {2571=>"11402.0"}, {2572=>"949.0"}, {2573=>"258.0"}, {2574=>"649.0"}, {2575=>"138.0"}, {2576=>"138.0"}, {2577=>"84.0"}, {2578=>"530.0"}, {2579=>"22585.0"}, {2580=>"1881.0"}, {2581=>"512.0"}, {2582=>"1286.0"}, {2583=>"274.0"}, {2584=>"274.0"}, {2585=>"167.0"}, {2586=>"489.0"}, {2587=>"16273.0"}, {2588=>"1355.0"}, {2589=>"369.0"}, {2590=>"926.0"}, {2591=>"198.0"}, {2592=>"198.0"}, {2593=>"120.0"}, {2594=>"350.0"}, {2616=>"9200.0"}, {2617=>"473.0"}, {2618=>"101.0"}, {2619=>"101.0"}, {2620=>"61.0"}, {2621=>"334.0"}, {2622=>"400.0"}, {2623=>"7000.0"}, {2624=>"360.0"}, {2625=>"77.0"}, {2626=>"77.0"}, {2627=>"46.0"}, {2628=>"316.0"}, {2629=>"13681.0"}, {2630=>"1139.0"}, {2631=>"310.0"}, {2632=>"779.0"}, {2633=>"166.0"}, {2634=>"166.0"}, {2635=>"101.0"}, {2636=>"510.0"}, {2637=>"20126.0"}, {2638=>"1676.0"}, {2639=>"456.0"}, {2640=>"1146.0"}, {2641=>"244.0"}, {2642=>"244.0"}, {2643=>"149.0"}, {2644=>"489.0"}, {2645=>"15006.0"}, {2646=>"1250.0"}, {2647=>"340.0"}, {2648=>"854.0"}, {2649=>"182.0"}, {2650=>"182.0"}, {2651=>"111.0"}, {2652=>"346.0"}, {2653=>"1878.0"}, {2654=>"450.0"}, {2660=>"13256.0"}, {2661=>"1104.0"}, {2662=>"300.0"}, {2663=>"755.0"}, {2664=>"161.0"}, {2665=>"161.0"}, {2666=>"98.0"}, {2667=>"530.0"}, {2668=>"9200.0"}, {2669=>"473.0"}, {2670=>"101.0"}, {2671=>"101.0"}, {2672=>"61.0"}, {2673=>"334.0"}, {2674=>"400.0"}, {2675=>"7000.0"}, {2676=>"360.0"}, {2677=>"77.0"}, {2678=>"77.0"}, {2679=>"46.0"}, {2680=>"316.0"}, {2681=>"10760.0"}, {2682=>"896.0"}, {2683=>"244.0"}, {2684=>"612.0"}, {2685=>"130.0"}, {2686=>"130.0"}, {2687=>"79.0"}, {2688=>"510.0"}, {2689=>"9027.0"}, {2690=>"752.0"}, {2691=>"204.0"}, {2692=>"514.0"}, {2693=>"109.0"}, {2694=>"109.0"}, {2695=>"66.0"}, {2696=>"329.0"}, {2697=>"9358.0"}, {2698=>"779.0"}, {2699=>"212.0"}, {2700=>"533.0"}, {2701=>"113.0"}, {2702=>"113.0"}, {2703=>"69.0"}, {2704=>"324.0"}, {2705=>"1204.0"}, {2706=>"18761.0"}, {2707=>"1562.0"}, {2708=>"425.0"}, {2709=>"1068.0"}, {2710=>"228.0"}, {2711=>"228.0"}, {2712=>"139.0"}, {2713=>"489.0"}, {2714=>"10252.0"}, {2715=>"854.0"}, {2716=>"232.0"}, {2717=>"583.0"}, {2718=>"124.0"}, {2719=>"124.0"}, {2720=>"75.0"}, {2721=>"346.0"}, {2722=>"746.0"}, {2723=>"450.0"}, {2724=>"10169.0"}, {2725=>"847.0"}, {2726=>"230.0"}, {2727=>"579.0"}, {2728=>"123.0"}, {2729=>"123.0"}, {2730=>"75.0"}, {2731=>"530.0"}, {2732=>"9200.0"}, {2733=>"473.0"}, {2734=>"101.0"}, {2735=>"101.0"}, {2736=>"61.0"}, {2737=>"334.0"}, {2738=>"600.0"}, {2753=>"7993.0"}, {2754=>"665.0"}, {2755=>"181.0"}, {2756=>"455.0"}, {2757=>"97.0"}, {2758=>"97.0"}, {2759=>"59.0"}, {2760=>"349.0"}, {2761=>"7000.0"}, {2762=>"360.0"}, {2763=>"77.0"}, {2764=>"77.0"}, {2765=>"46.0"}, {2766=>"302.0"}, {2767=>"14444.0"}, {2768=>"1203.0"}, {2769=>"327.0"}, {2770=>"822.0"}, {2771=>"175.0"}, {2772=>"175.0"}, {2773=>"107.0"}, {2774=>"329.0"}, {2775=>"15597.0"}, {2776=>"1299.0"}, {2777=>"354.0"}, {2778=>"888.0"}, {2779=>"189.0"}, {2780=>"189.0"}, {2781=>"115.0"}, {2782=>"324.0"}, {2783=>"3039.0"}, {2784=>"13751.0"}, {2785=>"1145.0"}, {2786=>"312.0"}, {2787=>"783.0"}, {2788=>"167.0"}, {2789=>"167.0"}, {2790=>"101.0"}, {2791=>"324.0"}, {2792=>"14322.0"}, {2793=>"1193.0"}, {2794=>"325.0"}, {2795=>"815.0"}, {2796=>"174.0"}, {2797=>"174.0"}, {2798=>"106.0"}, {2799=>"324.0"}, {2800=>"1.05"}, {2801=>"0.1"}]

# after recalc
[{2603=>"720.0"}, {2493=>"9200.0"}, {2494=>"473.0"}, {2495=>"101.0"}, {2496=>"101.0"}, {2497=>"61.0"}, {2498=>"334.0"}, {2499=>"400.0"}, {2500=>"7000.0"}, {2501=>"360.0"}, {2502=>"77.0"}, {2503=>"77.0"}, {2504=>"46.0"}, {2505=>"316.0"}, {2506=>"14757.0"}, {2507=>"1229.0"}, {2508=>"335.0"}, {2509=>"840.0"}, {2510=>"179.0"}, {2511=>"179.0"}, {2512=>"109.0"}, {2513=>"510.0"}, {2514=>"13442.0"}, {2515=>"1119.0"}, {2516=>"305.0"}, {2517=>"765.0"}, {2518=>"163.0"}, {2519=>"163.0"}, {2520=>"99.0"}, {2521=>"346.0"}, {2522=>"1447.0"}, {2523=>"450.0"}, {2524=>"21880.0"}, {2525=>"1822.0"}, {2526=>"496.0"}, {2527=>"1246.0"}, {2528=>"266.0"}, {2529=>"266.0"}, {2530=>"162.0"}, {2531=>"489.0"}, {2532=>"12154.0"}, {2533=>"1012.0"}, {2534=>"275.0"}, {2535=>"692.0"}, {2536=>"147.0"}, {2537=>"147.0"}, {2538=>"90.0"}, {2539=>"530.0"}, {2540=>"7000.0"}, {2541=>"360.0"}, {2542=>"77.0"}, {2543=>"77.0"}, {2544=>"46.0"}, {2545=>"316.0"}, {2546=>"11375.0"}, {2547=>"947.0"}, {2548=>"258.0"}, {2549=>"647.0"}, {2550=>"138.0"}, {2551=>"138.0"}, {2552=>"84.0"}, {2553=>"510.0"}, {2554=>"9200.0"}, {2555=>"473.0"}, {2556=>"101.0"}, {2557=>"101.0"}, {2558=>"61.0"}, {2559=>"334.0"}, {2560=>"400.0"}, {2561=>"13796.0"}, {2562=>"1149.0"}, {2563=>"313.0"}, {2564=>"785.0"}, {2565=>"167.0"}, {2566=>"167.0"}, {2567=>"102.0"}, {2568=>"346.0"}, {2569=>"1540.0"}, {2570=>"450.0"}, {2571=>"11402.0"}, {2572=>"949.0"}, {2573=>"258.0"}, {2574=>"649.0"}, {2575=>"138.0"}, {2576=>"138.0"}, {2577=>"84.0"}, {2578=>"530.0"}, {2579=>"22585.0"}, {2580=>"1881.0"}, {2581=>"512.0"}, {2582=>"1286.0"}, {2583=>"274.0"}, {2584=>"274.0"}, {2585=>"167.0"}, {2586=>"489.0"}, {2587=>"16273.0"}, {2588=>"1355.0"}, {2589=>"369.0"}, {2590=>"926.0"}, {2591=>"198.0"}, {2592=>"198.0"}, {2593=>"120.0"}, {2594=>"350.0"}, {2616=>"9200.0"}, {2617=>"473.0"}, {2618=>"101.0"}, {2619=>"101.0"}, {2620=>"61.0"}, {2621=>"334.0"}, {2622=>"400.0"}, {2623=>"7000.0"}, {2624=>"360.0"}, {2625=>"77.0"}, {2626=>"77.0"}, {2627=>"46.0"}, {2628=>"316.0"}, {2629=>"13681.0"}, {2630=>"1139.0"}, {2631=>"310.0"}, {2632=>"779.0"}, {2633=>"166.0"}, {2634=>"166.0"}, {2635=>"101.0"}, {2636=>"510.0"}, {2637=>"20126.0"}, {2638=>"1676.0"}, {2639=>"456.0"}, {2640=>"1146.0"}, {2641=>"244.0"}, {2642=>"244.0"}, {2643=>"149.0"}, {2644=>"489.0"}, {2645=>"15006.0"}, {2646=>"1250.0"}, {2647=>"340.0"}, {2648=>"854.0"}, {2649=>"182.0"}, {2650=>"182.0"}, {2651=>"111.0"}, {2652=>"346.0"}, {2653=>"1878.0"}, {2654=>"450.0"}, {2660=>"13256.0"}, {2661=>"1104.0"}, {2662=>"300.0"}, {2663=>"755.0"}, {2664=>"161.0"}, {2665=>"161.0"}, {2666=>"98.0"}, {2667=>"530.0"}, {2668=>"9200.0"}, {2669=>"473.0"}, {2670=>"101.0"}, {2671=>"101.0"}, {2672=>"61.0"}, {2673=>"334.0"}, {2674=>"400.0"}, {2675=>"7000.0"}, {2676=>"360.0"}, {2677=>"77.0"}, {2678=>"77.0"}, {2679=>"46.0"}, {2680=>"316.0"}, {2681=>"10760.0"}, {2682=>"896.0"}, {2683=>"244.0"}, {2684=>"612.0"}, {2685=>"130.0"}, {2686=>"130.0"}, {2687=>"79.0"}, {2688=>"510.0"}, {2689=>"9027.0"}, {2690=>"752.0"}, {2691=>"204.0"}, {2692=>"514.0"}, {2693=>"109.0"}, {2694=>"109.0"}, {2695=>"66.0"}, {2696=>"329.0"}, {2697=>"9358.0"}, {2698=>"779.0"}, {2699=>"212.0"}, {2700=>"533.0"}, {2701=>"113.0"}, {2702=>"113.0"}, {2703=>"69.0"}, {2704=>"324.0"}, {2705=>"1204.0"}, {2706=>"18761.0"}, {2707=>"1562.0"}, {2708=>"425.0"}, {2709=>"1068.0"}, {2710=>"228.0"}, {2711=>"228.0"}, {2712=>"139.0"}, {2713=>"489.0"}, {2714=>"10252.0"}, {2715=>"854.0"}, {2716=>"232.0"}, {2717=>"583.0"}, {2718=>"124.0"}, {2719=>"124.0"}, {2720=>"75.0"}, {2721=>"346.0"}, {2722=>"746.0"}, {2723=>"450.0"}, {2724=>"10169.0"}, {2725=>"847.0"}, {2726=>"230.0"}, {2727=>"579.0"}, {2728=>"123.0"}, {2729=>"123.0"}, {2730=>"75.0"}, {2731=>"530.0"}, {2732=>"9200.0"}, {2733=>"473.0"}, {2734=>"101.0"}, {2735=>"101.0"}, {2736=>"61.0"}, {2737=>"334.0"}, {2738=>"600.0"}, {2753=>"7993.0"}, {2754=>"665.0"}, {2755=>"181.0"}, {2756=>"455.0"}, {2757=>"97.0"}, {2758=>"97.0"}, {2759=>"59.0"}, {2760=>"349.0"}, {2761=>"7000.0"}, {2762=>"360.0"}, {2763=>"77.0"}, {2764=>"77.0"}, {2765=>"46.0"}, {2766=>"302.0"}, {2767=>"14444.0"}, {2768=>"1203.0"}, {2769=>"327.0"}, {2770=>"822.0"}, {2771=>"175.0"}, {2772=>"175.0"}, {2773=>"107.0"}, {2774=>"329.0"}, {2775=>"15597.0"}, {2776=>"1299.0"}, {2777=>"354.0"}, {2778=>"888.0"}, {2779=>"189.0"}, {2780=>"189.0"}, {2781=>"115.0"}, {2782=>"324.0"}, {2783=>"3039.0"}, {2784=>"13751.0"}, {2785=>"1145.0"}, {2786=>"312.0"}, {2787=>"783.0"}, {2788=>"167.0"}, {2789=>"167.0"}, {2790=>"101.0"}, {2791=>"324.0"}, {2792=>"14322.0"}, {2793=>"1193.0"}, {2794=>"325.0"}, {2795=>"815.0"}, {2796=>"174.0"}, {2797=>"174.0"}, {2798=>"106.0"}, {2799=>"324.0"}, {2800=>"1.05"}, {2801=>"0.1"}]


inv = Invoice.find 475
inv.save!


boo = Booking.find 2312
boo.amount.to_s

line_items
line_items.collect do |line_item|
    line_item.save!
end